<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Q+ vs Browsers</title>
        <link href="css/main_new.css" rel="stylesheet" />
        <script src="js/jx.dom.event.fx.js"></script>
    </head>

    <body>
        <div id="doc" class="doc full">
            <div class="nav">
                <h1 class="nav-title">Q+ vs Browsers</h1>
                <ul id="nav-ul" class="nav-ul">
					<li data-key="diff"><span>平台性差异</span></li>
                    <li data-key="load"><span>加载性能</span></li>
                    
                    <li data-key="render"><span>渲染性能</span></li>
                    <li data-key="js"><span>js执行效率</span></li>
                    <li data-key="features"><span>新特性支持</span></li>
                    
                    <li data-key="system"><span>系统资源占用</span></li>
                    <li data-key="css"><span>css兼容性</span></li>
                    <li data-key="acid3"><span>Acid3标准测试</span></li>
                    <li data-key="psychedelic"><span>硬件加速</span></li>
                    
                    <li data-key="all"><span>综合测试</span></li>
                    <li data-key="summary"><span>总结</span></li>
                    <li data-key="others"><span>其他</span></li>
                </ul>
            </div>

            <div id="content" class="content">
                <iframe id="ifm" class="opa0" style="background-color: transparent; border: 0px;" frameborder="0" width="100%" height="100%" allowTransparency="true" src="about:blank"></iframe>
            </div>
        </div>

        <script>

            Jx().$package('JxHome', function (J) {
                var $D = J.dom,
                $E = J.event,
                $FX = J.fx,
                pkg = this;

                var urlHash = {
                    'diff': 'frames/diff.html',
                    'load': 'frames/loading-performance.html',
                    'render': 'frames/render-performance.html',
                    'js': 'frames/js-performance.html',
                    'css': 'frames/css-compatible.html',
                    'acid3': 'frames/acid3.html',
                    'system': 'frames/system.html',
                    'features': 'frames/features-support.html',
                    'psychedelic': 'frames/psychedelic.html',
                    'all': 'frames/all.html',
                    'summary': 'frames/summary.html',
                    'others': 'frames/others.html'
                }, $ifm, $navUl, $lis, $doc;	

                function supportCanvas () {
                    var canvas = document.createElement('canvas');
                    return !!canvas.getContext;
                }

                function getViewport () {
                    return {
                        width: J.browser.ie > 0 ? document.documentElement.clientWidth : window.innerWidth,
                        height: J.browser.ie > 0 ? document.documentElement.clientHeight : window.innerHeight
                    }
                }
                //冒泡到 指定元素
                function bubbleTo (target, nodeName, key) {
                    if (target == document.documentElement) {
                        return null;
                    }
                    return (target.nodeName.toLowerCase() == nodeName && !!target.getAttribute(key)) ? target : bubbleTo(target.parentNode, nodeName, key)
                }

                function resize () {
                    var vp = getViewport();
                    $D.setStyle($doc, 'height', Math.max(400, vp.height) + 'px');
                    $ifm.height = vp.height;
                }
                
                function getLiByKey(key) {
                    for (var i = 0; i < $lis.length; i ++) {
                        var k = $lis[i].getAttribute('data-key');
                        if (k == key) {
                            return $lis[i];
                        }
                    }
                    return null;
                }

                function navItemClick (e) {
                    var url, hash;
                    if (typeof e == 'string') {
                        url = urlHash[e];
                        hash = e;
                        var tar = getLiByKey(e);
                        } else {
                        var tar = bubbleTo(e.target, 'li', 'data-url');
                        if (tar) {
                            hash = tar.getAttribute('data-key');
                            url = tar.getAttribute('data-url');
                        }
                    }
                    if (tar && $D.hasClass(tar, 'selected')) {
                        return;
                    }
                    
                    if (!!url) {
                        //$D.setStyle($ifm, 'opacity', 0);
                        $ifm.setAttribute('src', url);
                        location.hash = hash || '';
                    }

                    if (tar) {
                        for (var i = 0; i < $lis.length; i ++) {
                            $D.removeClass($lis[i], 'selected');
                        }
                        $D.addClass(tar, 'selected');
                    }

                }

                this.init = function () {
                    this.getEls();
                    this.setDataUrl();
                    this.bind();
                    resize();
                    
                    var hash = location.hash.replace(/^#/, '') || 'diff';
                    navItemClick(hash);		
                }
                this.getEls = function () {
                    $ifm = $D.id('ifm');
                    $navUl = $D.id('nav-ul');
                    $doc = $D.id('doc');
                    $lis = $navUl.getElementsByTagName('li');
                }
                this.setDataUrl = function () {
                    var lis = $navUl.getElementsByTagName('li');
                    for (var i = 0; i < lis.length; i ++) {
                        var li = lis[i],
                        key = li.getAttribute('data-key');
                        if (!!urlHash[key]) {
                            li.setAttribute('data-url', urlHash[key]);	
                        }
                    }
                }
                this.bind = function () {
                    $E.on($navUl, 'click', navItemClick);
                    $E.on(window, 'resize', resize);
                    $E.on($ifm, 'load', function () {
                        $FX.animate($ifm, {
                            opacity: 1
                        });
                        resize();
                    })
                }

                $E.onDomReady(function () {
                    pkg.init();
                })
            });

        </script>

    </body>
</html>
