<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>总结</title>
        <link href="../css/frames-common.css" rel="stylesheet"/>
    </head>
    
    <body>
        <div class="doc">
            <h2>各方性能测试汇总</h2>
            <ul>
                <li>
                    <h3>平台性异同</h3>
                    <ol>
                        <li>Q+ app 本质是一个浏览器加载web页面的形态。而且目前也提供了IE内核和webkit两种内核给开发者选择。在内核和形态方面，跟国内一些双核浏览器，比如360，sougou等有类似的地方，因此也就有了一些可对比性。</li>
                        <li>Q+ 使用的IE内核取自系统，因此理论上Q+ IE的版本会跟系统IE版本保持一致。但是当系统IE版本升级到7.0以上时，因为IE本身兼容模式的原因。Q+ 使用的IE 渲染模式依旧停留在IE7.0，而且文本模式documentMode还是5</li>
                        <li>在IE内核方面，国内其他双核浏览器亦是如此，但是360浏览器做了些优化，比如检测到用户系统有装IE9.0以上版本时，可以将IE内核强制转化为IE9的模式。毕竟IE9无论在性能上还是新特性支持上都会有质的提升。</li>
                        <li>
                            Q+ webkit 使用的是 chromium 10的内核，所以在性能和特性支持上还不太完备。而其他双核浏览器，基本webkit内核版本都会随着不断更新递进。
                        </li>
                        <li>
                            另外，在app整个外围基础架构上，Q+ 里面增加了一个 接口包装和适配的vm层。这也是同样一个app在Q+ 里面打开和 浏览器里直接运行不同的地方。vm层的包装有利于我们对于接口的统一规划，便于后期的各项扩展，因为vm层的存在，app运行之前会先加载vm相关的几个资源，vm.html,vm.js等，因为app cache等原因，目前来看对性能影响不大，大概在0.5s左右。
                        </li>
                        
                    </ol>
                </li> 
                
                <li>
                    <h3>加载性能</h3>
                    <ol>
                        <li>在IE内核下，有较大影响的是并发连接数。</li>
                        <li>Q+ 3.2版本之后，并发连接数都已经做了优化，至少能和系统自带IE保持一致或者略高于系统自带IE。</li>
                        <li>由于webkit 默认的并发连接数就为6，基本能满足现代网络的需求。从测试结果来看，webkit下面对资源加载时间能和市面webkit浏览器基本一致。略低5%~10%左右</li>
                    </ol>
                </li>
                
                <li>
                    <h3>渲染性能</h3>
                    <p>分两块来看，一个是对dom树 reflow 和repaint 的性能，一个是 webkit下对于一些特殊元素，比如canvas，svg等的渲染性能。</p>
                    <ol>
                        <li>在IE内核下，dom 的 reflow 和reapint 等性能，在系统IE版本较高时（>=8）,明显远低于系统IE。比如当系统装IE9时，前面测试发现，Q+ 使用7.0的渲染模式会使dom 的reflow 和repaint性能 低 IE9 约7倍左右</li>
                        <li>webkit内核下，Q+ 所用的chromium 10.0 版本，对于dom render的性能比chrome18 低2~3 倍。</li>
                        <li>Q+ 目前暂时只 支持 canvas 2d context，对于2d context的cpu计算与渲染。效率比chrome18 低2倍左右。</li>
                    </ol>
                </li>
                
                <li>
                    <h3>JS 执行效率</h3>
                    <ol>
                        <li>Q+IE 的内核js性能最多只能和IE7持平，parse效率低于IE9大约3倍，执行效率低15倍。</li>
                        <li>webkit内核下，Q+ 所用的chromium 10.0 版本 比chrome18 低1倍左右</li>
                    </ol>
                </li>
                
                <li>
                    <h3>HTML5 新特性</h3>
                    <p>这几个希望能支持到</p>
                    <ol>
                        <li>Video 方面MPEG-4 和H.264 编码格式的支持</li>
                        <li>Geolocation 的支持</li>
                        <li>WebGL 3D context 的支持</li>
                        <li>浏览器原生notification的支持</li>
                    </ol>
                </li>
                
                <li>
                    <h3>系统资源占用情况</h3>
                    <ol>
                        <li>这一块，Q+ app IE内核还比较好，可能是因为用的低版本IE内核的原因</li>
                        <li>Q+ 主进程 Qplus.exe 资源占用算高的，启动Q+ ，什么窗口不开，什么都不操作，内存占用在30M+， 如果有一些滑屏操作的话，比如Q+屏和桌面屏切换的时候，cpu会突然涨20%左右</li>
                        <li>Q+ app webkit窗口，一个单独的窗口比chrome一个tab进程占用资源略多一些。</li>
                    </ol>
                </li>
                
                <li>
                    <h3>css兼容性和Acid3测试</h3>
                    <ol>
                        <li>两项测试，Q+ IE内核在IE7.0 水准（系统装机IE9.0）</li>
                        <li>Q+ webkit 对于css selector 测试，对于:nth-*** 相关的选择器支持的不是很好。</li>
                        <li>Q+ webkit 在 在Acid3标准测试中，稍有瑕疵</li>
                    </ol>
                </li>
                
                <li>
                    <h3>关于硬件加速</h3>
                    <ol>
                        <li>这一块，Q+ webkit 严重缺失，导致对于一些需要硬件加速支持的渲染，比如3D，或者纹理渲染方面，效率严重低于IE9和新版chrome。</li>
                        <li>同时，由于GPU的协助不能用，使 webGL 也暂时处于不可用状态。</li>
                    </ol>
                </li>
                
            </ul>
            
            
            <h2>建议</h2>
            <p>从上面基本可以看出，现在Q+ 主要的瓶颈还是在渲染性能和一些特性支持方面。因此，假如能实现以下几点的话，应该会让Q+ 的性能再有质的提升。</p>
            <ul>
                <li>IE 方面
                    <p>如果IE9使用的Chakra JavaScript 引擎不大的话，是否可以考虑将其也打包进Q+</p>
                    <p>如果不能打包，能否保证Q+ 取用的IE内核为系统最高版本，比如系统装了IE9，那么就用IE9的内核，不要始终用IE7.0的内核，如果能做到这样，那么再辅助我们对于并发连接数和其他方面的一些优化，也能使 至少 系统装有 大于 IE7版本的用户的性能得到提升。</p>
                </li>
                <li>
                    webkit 方面
                    <p>资源加载那一块，倒没有很大差别，但是在渲染性能上，chromium10.0的版本还是偏低了，同IE9 和 较新的chrome版本比起来的话，无论是在Dom 渲染， canvas重绘性能，还是JS引擎上，都差一些。</p>
                    <p>假如我们的webkit 也能 update 一下的话，相信对于整体的性能应该也会有一些帮助。</p>
                </li>
                <li>
                    特性支持方面
                    <p>像Geolocation或者notification一类的，假如能支持得到最好，如果没法原生支持，不知是否可以考虑自己用类似的api来实现类似的功能，比如想qplus.window.fullScreen这样。</p>
                    <p>硬件加速，GPU渲染，WebGL的支持，虽然目前可能应用场景和app不多，但是这一块能支持上的话，一个是将来说不定会有nb的开发者，对webGL有研究的开发者可以用这个特性做出一些酷炫的应用。</p>
                    <p>另外，硬件加速的支持，在某些特殊的场合，比如一些纹理渲染，游戏场景生成的地方，对渲染性能会有很大提升。</p>
                </li>
            </ul>
        </div>
    </body>
</html>
